<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

</head>
<body>

    <script>
    // Функция для получения данных с удалённого текстового файла
async function fetchData() {
    const url = "https://hamsauno.github.io/Miner/kursBTC.txt"; 

    try {
        const response = await fetch(url);
        console.log("Ответ от сервера:", response);

        if (!response.ok) {
            throw new Error('Не удалось загрузить данные. Статус: ' + response.status);
        }

        const data = await response.text();
        console.log("Полученные данные:", data);

        if (!data || data.trim().length === 0) {
            throw new Error('Загруженные данные пусты.');
        }

        // Разделяем данные на строки и убираем лишние пробелы
        let lines = data.trim().split("\n").map(line => line.trim());
        console.log("Обработанные строки:", lines);

        // Проверяем, что данных достаточно
        if (lines.length < 9) {
            throw new Error(`Ошибка: недостаточно строк в файле (ожидалось 9, получено ${lines.length})`);
        }

        // Функция парсинга чисел с заменой запятой на точку
        const parseValue = (str) => parseFloat(str.replace(",", "."));

        const ltcPrice = parseValue(lines[3]);
        const dogePrice = parseValue(lines[4]);
        const bellPrice = parseValue(lines[5]);
        const usdtPrice = parseValue(lines[1]);
        const profitPerLTC = parseValue(lines[6]);
        const profitPerDOGE = parseValue(lines[7]);
	const profitPerBELL = parseValue(lines[8]);
       

        console.log("ltcPrice:", ltcPrice);
        console.log("dogePrice:", dogePrice);
        console.log("bellPrice:", bellPrice);
        console.log("usdtPrice:", usdtPrice);
        console.log("profitPerLTC:", profitPerLTC);
        console.log("profitPerDOGE:", profitPerDOGE);
        console.log("profitPerBELL:", profitPerBELL);

        // Проверяем корректность данных
        if ([ltcPrice, dogePrice, bellPrice, usdtPrice, profitPerLTC, profitPerDOGE, profitPerBELL].some(isNaN)) {
            throw new Error("Некоторые значения в файле не являются числами.");
        }

        // Заполняем скрытые поля
        document.getElementById("ltcPrice").value = ltcPrice.toFixed(2);
        document.getElementById("dogePrice").value = dogePrice.toFixed(4);
        document.getElementById("bellPrice").value = bellPrice.toFixed(4);
        document.getElementById("usdtPrice").value = usdtPrice.toFixed(8);
        document.getElementById("profitPerLTC").value = profitPerLTC.toFixed(8);
        document.getElementById("profitPerDOGE").value = profitPerDOGE.toFixed(8);
        document.getElementById("profitPerBELL").value = profitPerBELL.toFixed(8);

    } catch (error) {
        console.error("Ошибка загрузки файла:", error);
        alert("Ошибка загрузки данных. Проверьте доступность файла.");
    }
}

// Запускаем загрузку данных при открытии страницы
window.onload = async function() {
    await fetchData();
    updateAsicSpecs();
};

    // Функция для обновления характеристик выбранной модели ASIC
    function updateAsicSpecs() {
        const asicData = {
            L917: { a:17, b:3360 },
            L916: { a:16, b:3360 },
            L915: { a:15, b:3360 },
            DG14: { a:14, b:3950 },
            DG13: { a: 13, b:3950 },
            DGhome: { a: 2.1, b:630 }
        };

        let selectedModel = document.getElementById("asicModel").value;
        document.getElementById("hashrate").value = asicData[selectedModel].a;
        document.getElementById("power").value = asicData[selectedModel].b;
    }

    // Функция для расчёта доходности и прибыли
    function calculateProfit() {
        const ltcPrice = parseFloat(document.getElementById("ltcPrice").value);
        const dogePrice = parseFloat(document.getElementById("dogePrice").value);
        const bellPrice = parseFloat(document.getElementById("bellPrice").value);
        const usdtPrice = parseFloat(document.getElementById("usdtPrice").value);
        const profitPerLTC = parseFloat(document.getElementById("profitPerLTC").value);
        const profitPerDOGE = parseFloat(document.getElementById("profitPerDOGE").value);
        const profitPerBELL = parseFloat(document.getElementById("profitPerBELL").value);

        // Логируем полученные значения
        console.log("ltcPrice:", ltcPrice);
        console.log("dogePrice:", dogePrice);
        console.log("bellPrice:", bellPrice);
        console.log("usdtPrice:", usdtPrice);
        console.log("profitPerLTC:", profitPerLTC);
        console.log("profitPerDOGE:", profitPerDOGE);
        console.log("profitPerBELL:", profitPerBELL);

        if (isNaN(ltcPrice) || isNaN(dogePrice) || isNaN(bellPrice) || isNaN(usdtPrice) || isNaN(profitPerLTC) || isNaN(profitPerDOGE) || isNaN(profitPerBELL)) {
            alert("Данные для расчета отсутствуют или некорректны.");
            return;
        }

        let a = parseFloat(document.getElementById("hashrate").value);
        let b = parseFloat(document.getElementById("power").value);
        let h = parseFloat(document.getElementById("electricityCost").value);
        let c = parseFloat(document.getElementById("asicCost").value);

        let dailyIncome = (a * profitPerLTC * ltcPrice) + (a * profitPerDOGE * dogePrice) + (a * profitPerBELL * bellPrice);
        let monthlyIncome = dailyIncome * 30.5;
        let yearlyIncome = dailyIncome * 365;

        let dailyElectricityCost = ((b / 1000) * h * 24) / usdtPrice;
        let dailyProfit = dailyIncome - dailyElectricityCost;
        let monthlyProfit = dailyProfit * 30.5;
        let yearlyProfit = dailyProfit * 365;
        let roi = (dailyProfit * 365 / (c / usdtPrice)) * 100;
        let payback = ((c / usdtPrice) / dailyProfit) / 30.5;

        document.getElementById("income").innerText = dailyIncome.toFixed(2);
        document.getElementById("profit").innerText = dailyProfit.toFixed(2);
        document.getElementById("incomeMonth").innerText = monthlyIncome.toFixed(2);
        document.getElementById("incomeYear").innerText = yearlyIncome.toFixed(2);
        document.getElementById("profitMonth").innerText = monthlyProfit.toFixed(2);
        document.getElementById("profitYear").innerText = yearlyProfit.toFixed(2);
        document.getElementById("roi").innerText = roi.toFixed(2);
        document.getElementById("payback").innerText = payback.toFixed(0);
    }

    // Загружаем данные и обновляем элементы
    window.onload = async function() {
        await fetchData(); // Загружаем данные из файла kursBTC.txt
        updateAsicSpecs(); // Обновляем характеристики ASIC
    }
    </script>

    <button onclick="window.history.back();">Назад</button>

    <label>Модель Асика:
        <select id="asicModel" onchange="updateAsicSpecs()">
            <option value="L917">Antminer L9 17G</option>
            <option value="L916">Antminer L9 16G</option>
            <option value="L915">Antminer L9 15G</option>
            <option value="DG14">Elphapex DG1+ 14G</option>
            <option value="DG13">Elphapex DG1+ 13G</option>
            <option value="DGhome">Elphapex DG home 2,1G</option>
        </select>
    </label>
    <label>Стоимость розетки (руб): <input type="number" id="electricityCost" value="5"></label>
    <label>Стоимость Асика (руб): <input type="number" id="asicCost" value="500000"></label>
    <label>Хэшрейт (TH/s): <input type="number" id="hashrate" readonly></label>
    <label>Энергопотребление (Вт): <input type="number" id="power" readonly></label>
    <label><input type="hidden" id="ltcPrice" readonly></label>
    <label><input type="hidden" id="dogePrice" readonly></label>
    <label><input type="hidden" id="bellPrice" readonly></label>
    <label><input type="hidden" id="usdtPrice" readonly></label>
    <label><input type="hidden" id="profitPerLTC" readonly></label>
    <label><input type="hidden" id="profitPerDOGE" readonly></label>
    <label><input type="hidden" id="profitPerBELL" readonly></label>
    <button onclick="calculateProfit()">Рассчитать</button>
    
    <h2>Результаты</h2>
    <p>Доход :</p>
    <p>День: <span id="income">0</span> $</p>
    <p>Месяц: <span id="incomeMonth">0</span> $</p>
    <p>Год: <span id="incomeYear">0</span> $</p>
    
    <p>Прибыль :</p>
    <p>День: <span id="profit">0</span> $</p>
    <p>Месяц: <span id="profitMonth">0</span> $</p>
    <p>Год: <span id="profitYear">0</span> $</p>
    
    <p>Процент годовых: <span id="roi">0</span>%</p>
    <p>Окупаемость: <span id="payback">0</span> месяцев</p>

</body>
</html>
