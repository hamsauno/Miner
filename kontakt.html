<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/bg.css">
  <script src="js/fullscr.js" defer></script>
  <script src="js/nozoom.js" defer></script>
</head>
<body class="bg-white text-black font-[Arial]">
<!-- –ë–ª–æ–∫ –≤—ã—Å–æ—Ç–æ–π 140px -->
<div class="w-full bg-[#E2E2E2] text-black text-xs sm:text-sm px-4 py-2 overflow-y-auto flex flex-col justify-between" style="height: 140px;">
    <div class="space-y-2 leading-relaxed">
      <div class="grid grid-cols-[auto,1fr] gap-2">
        <p class="text-right"><strong>–û—Ñ–∏—Å :</strong></p>
        <p>
          <button class="underline hover:text-blue-600 text-left" onclick="openMap('https://yandex.ru/maps/org/waymorr/39016942329/?ll=37.576007%2C55.772289&z=17.12')">
            –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—É–ª–æ–∫, 3/10—Å1
          </button>
        </p>
      </div>
  
      <div class="grid grid-cols-[auto,1fr] gap-2">
        <p class="text-right"><strong>–°–∫–ª–∞–¥ :</strong></p>
        <p>
          <button class="underline hover:text-blue-600 text-left" onclick="openMap('https://yandex.ru/maps/213/moscow/house/krasnokazarmennaya_ulitsa_12s38/Z04YcQdgQUUGQFtvfXt0d31hZw==/?ll=37.700801%2C55.756123&z=17.12')">
            –ö—Ä–∞—Å–Ω–æ–∫–∞–∑–∞—Ä–º–µ–Ω–Ω–∞—è —É–ª–∏—Ü–∞, 12—Å38
          </button>
        </p>
      </div>
  
      <div class="grid grid-cols-[auto,1fr] gap-2">
        <p class="text-right"><strong>–¢–µ–ª–µ—Ñ–æ–Ω :</strong></p>
        <p>
          <a href="tel:+74951297535" class="underline hover:text-blue-600" target="_blank" rel="noopener noreferrer">+7 (495) 129-75-35</a>
        </p>
      </div>
    </div>
  
<!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫" -->
<div class="w-full text-center">
    <a id="callOrderBtn"
       href="#"
       class="mt-2 block text-center bg-[#2511A8] text-white text-base font-semibold py-2 w-full">
      –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫
    </a>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-[#E2E2E2] w-11/12 max-w-md p-4">
      <h2 class="text-lg font-semibold mb-2">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h2>
      <label class="block mb-2 text-sm">–°—Ç—Ä–∞–Ω–∞:</label>
      <select id="countryCode" class="w-full mb-3 px-3 py-2 border">
        <option value="+7">üá∑üá∫ +7</option>
        <option value="+375">üáßüáæ +375</option>
        <option value="+380">üá∫üá¶ +380</option>
        <option value="+996">üá∞üá¨ +996</option>
      </select>
  
      <label class="block mb-1 text-sm">–ù–æ–º–µ—Ä (–ø—Ä–∏–º–µ—Ä: 999-222-55-77):</label>
      <input type="tel" id="userPhone" class="w-full mb-3 px-3 py-2 border" placeholder="999-222-55-77">
  
      <label class="inline-flex items-center mb-4">
        <input type="checkbox" id="savePhone" class="mr-2">
        <span class="text-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–º–µ—Ä</span>
      </label>
  
      <div class="flex justify-between">
        <button id="cancelBtn" class="bg-[#2511A8] text-white px-4 py-2 w-1/2">–û—Ç–º–µ–Ω–∏—Ç—å</button>
        <button id="submitBtn" class="bg-[#2511A8] text-white px-4 py-2 w-1/2">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
  
    const supabase = createClient(
      "https://yiprwrgmyqlkdmhgulmc.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpcHJ3cmdteXFsa2RtaGd1bG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2NTI0NjgsImV4cCI6MjA2MDIyODQ2OH0.lfiTfr5ukGDEVuwq-X9U2kWs3nEZrp3N443HT5AkbfI"
    );
  
    const callOrderBtn = document.getElementById("callOrderBtn");
    const modalOverlay = document.getElementById("modalOverlay");
    const cancelBtn = document.getElementById("cancelBtn");
    const submitBtn = document.getElementById("submitBtn");
  
    async function checkAndSend() {
      const tg = window.Telegram.WebApp;
      const telegram_id = tg.initDataUnsafe?.user?.id;
  
      if (!telegram_id) return;
  
      const { data } = await supabase
        .from("users")
        .select("nombe_tel")
        .eq("telegram_id", telegram_id)
        .single();
  
      if (data && data.nombe_tel) {
        const encoded = encodeURIComponent(`POZVONI_MNE_${data.nombe_tel}`);
        window.location.href = `https://t.me/WAYMORR_BOT?start=${encoded}`;
      } else {
        modalOverlay.classList.remove("hidden");
      }
    }
  
    callOrderBtn.addEventListener("click", (e) => {
      e.preventDefault();
      checkAndSend();
    });
  
    cancelBtn.addEventListener("click", () => {
      modalOverlay.classList.add("hidden");
    });
  
    submitBtn.addEventListener("click", async () => {
      const phone = document.getElementById("userPhone").value.trim();
      const code = document.getElementById("countryCode").value;
      const save = document.getElementById("savePhone").checked;
      const fullPhone = `${code}${phone}`;
  
      const tg = window.Telegram.WebApp;
      const telegram_id = tg.initDataUnsafe?.user?.id;
  
      if (!telegram_id) return;
  
      if (save) {
        await supabase
          .from("users")
          .upsert({ telegram_id, nombe_tel: fullPhone }, { onConflict: ['telegram_id'] });
      }
  
      const encoded = encodeURIComponent(`POZVONI_MNE_${fullPhone}`);
      window.location.href = `https://t.me/WAYMORR_BOT?start=${encoded}`;
    });
  </script>
  
  
  <script>
    function openMap(url) {
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.openLink(url);
      } else {
        window.open(url, '_blank');
      }
    }
  </script>
</body>
</html>

