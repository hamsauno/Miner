<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –º–∞–π–Ω–∏–Ω–≥–∞</title>
<meta name="description" content="–£–¥–æ–±–Ω—ã–π Telegram-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ ASIC-–º–∞–π–Ω–µ—Ä–æ–≤. –î–æ—Ö–æ–¥, –ø—Ä–∏–±—ã–ª—å, ROI, –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.">
<style>
  html, body {
    overscroll-behavior-y: none; /* –∑–∞–ø—Ä–µ—â–∞–µ—Ç "–æ—Ç–ø—Ä—É–∂–∏–Ω–∏–≤–∞–Ω–∏–µ" –Ω–∞ iOS –∏ Android */
    touch-action: pan-y; /* –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
  }
  /* Ensure no rounded corners */
  input, select {
    border-radius: 0 !important;
    -webkit-appearance: none; /* Remove default iOS styling */
    -moz-appearance: none; /* Remove default Firefox styling */
    appearance: none; /* Remove default styling */
  }
  /* Style for currency buttons */
  .currency-btn {
    border: none;
    padding: 0.5rem; /* Adjust padding as needed */
    margin: 0;
    font-size: 0.75rem; /* text-xs */
    font-weight: bold;
    transition: background-color 0.3s, color 0.3s;
    width: 50%; /* Make buttons take half the cell width */
    line-height: 1; /* Adjust line height if needed */
    height: 100%; /* Make buttons fill cell height */
  }
  .currency-btn.active {
    background-color: #E2E2E2;
    color: black;
  }
  .currency-btn.inactive {
    background-color: #2511A8;
    color: white;
  }
  .currency-btn:hover {
    filter: brightness(110%);
  }
  /* Remove spinner buttons from number inputs */
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ–±—É—á–µ–Ω–∏—è */
  .tutorial-modal-overlay {
      display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      position: fixed;
      z-index: 9998; /* –ß—É—Ç—å –Ω–∏–∂–µ —Å–∞–º–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  }

  .tutorial-modal {
      display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      position: fixed;
      z-index: 9999;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: #1F2937; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –º–æ–¥–∞–ª–∫–∏ (Tailwind gray-800) */
      color: #F3F4F6; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç (Tailwind gray-100) */
      padding: 20px;
      border: 1px solid #4B5563; /* Tailwind gray-600 */
      width: 90%;
      max-width: 450px;
      border-radius: 8px; /* –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Tailwind rounded-none –∑–¥–µ—Å—å */
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
  }
  .tutorial-modal h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.25rem; /* text-xl */
      font-weight: 600; /* font-semibold */
  }
  .tutorial-modal p {
      margin-bottom: 20px;
      font-size: 0.875rem; /* text-sm */
      line-height: 1.5;
  }
  .tutorial-modal button {
      padding: 10px 15px;
      font-size: 0.875rem; /* text-sm */
      font-weight: 500; /* font-medium */
      cursor: pointer;
      border: none;
      border-radius: 6px; /* –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Tailwind rounded-none –∑–¥–µ—Å—å */
      transition: background-color 0.2s;
  }
  .tutorial-modal-next-btn {
      background-color: #2563EB; /* Tailwind blue-600 */
      color: white;
  }
  .tutorial-modal-next-btn:hover {
      background-color: #1D4ED8; /* Tailwind blue-700 */
  }
  .tutorial-modal-skip-btn {
      background-color: #4B5563; /* Tailwind gray-600 */
      color: #F3F4F6; /* Tailwind gray-100 */
      margin-left: 10px;
  }
  .tutorial-modal-skip-btn:hover {
      background-color: #374151; /* Tailwind gray-700 */
  }

  /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ */
  .tutorial-highlight {
      box-shadow: 0 0 0 3px #FBBF24, 0 0 15px 3px #FBBF24; /* Tailwind amber-400 */
      border-radius: 4px !important; /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
      transition: box-shadow 0.3s ease-in-out;
      position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
      z-index: 1; /* –ß—Ç–æ–±—ã –±—ã–ª–æ –Ω–∞–¥ –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  }
</style>

</head>
<body class="bg-black"> <div id="headerSection" class="w-full bg-[#000000] text-white shadow-xl p-5 mb-[3px]">
      <div class="form-content space-y-2">
         <div class="flex gap-3">
           <div class="w-1/2">
             <label for="algorithmSelect" class="block text-sm font-medium mb-1">–ê–ª–≥–æ—Ä–∏—Ç–º</label>
             <select id="algorithmSelect"
               class="bg-[#E2E2E2] w-full px-2 py-1 border border-gray-400 text-black text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-none">
               <option value="SHA-256">SHA-256</option>
               <option value="Scrypt">SCRYPT</option>
             </select>
           </div>
           <div class="w-1/2">
             <label for="manufacturerSelect" class="block text-sm font-medium mb-1">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
             <select id="manufacturerSelect"
               class="bg-[#E2E2E2] w-full px-2 py-1 border border-gray-400 text-black text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-none">
               </select>
           </div>
         </div>

         <div>
           <label for="asicModel" class="block text-sm font-medium mb-1">–ú–æ–¥–µ–ª—å –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</label>
           <select id="asicModel"
             class="bg-[#E2E2E2] w-full px-2 py-1 border border-gray-400 text-black text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-none">
             </select>
         </div>

         <div class="flex gap-3">
           <div class="w-1/2">
             <label class="block text-sm font-medium mb-1">–•—ç—à—Ä–µ–π—Ç</label>
             <div id="hashrateContainer" class="bg-[#E2E2E2] px-2 py-1 text-sm text-black min-h-[28px] rounded-none"> <span id="hashrate"></span> <span id="edprice"></span>
             </div>
           </div>
           <div class="w-1/2">
             <label class="block text-sm font-medium mb-1">–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</label>
             <div id="powerContainer" class="bg-[#E2E2E2] px-2 py-1 text-sm text-black min-h-[28px] rounded-none"> <span id="power"></span><span id="power_unit"></span> </div>
           </div>
         </div>

         <div class="flex gap-3">
           <div class="w-1/2">
             <label for="electricityCost" class="block text-sm font-medium mb-1">–°—Ç–æ–∏–º–æ—Å—Ç—å <br> –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏</label>
             <div class="relative">
               <input
                 type="number"
                 id="electricityCost"
                 value="5"
                 inputmode="decimal"
                 step="any"
                 class="bg-[#E2E2E2] w-full px-2 py-1 pr-6 border border-gray-400 text-black text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-none">
               <span class="absolute right-2 top-1/2 -translate-y-1/2 text-black text-xs">‚ÇΩ</span>
             </div>
           </div>
           <div class="w-1/2">
             <label for="asicCost" class="block text-sm font-medium mb-1">–°—Ç–æ–∏–º–æ—Å—Ç—å <br> –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</label>
             <div class="relative">
               <input type="number" id="asicCost" inputmode="numeric"
                 class="bg-[#E2E2E2] w-full px-2 py-1 pr-6 border border-gray-400 text-black text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 rounded-none"
                 placeholder="–ê–≤—Ç–æ/–†—É—á–Ω–æ–π –≤–≤–æ–¥"> <span class="absolute right-2 top-1/2 -translate-y-1/2 text-black text-xs">‚ÇΩ</span>
             </div>
           </div>
         </div>

         <input type="hidden" id="btcPrice">
         <input type="hidden" id="usdtPrice">
         <input type="hidden" id="profitPerTH">
         <input type="hidden" id="ltcPrice">
         <input type="hidden" id="dogePrice">
         <input type="hidden" id="bellPrice">
         <input type="hidden" id="profitPerLTC">
         <input type="hidden" id="profitPerDOGE">
         <input type="hidden" id="profitPerBELL">
      </div>
      <div class="button-container pt-2">
        <button id="calculateBtn"
          class="w-full text-white font-bold text-base py-2 px-4 transition duration-300 hover:brightness-110 shadow-md rounded-none"
          style="background-color: #2511A8;">
          –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
        <div id="notification" class="mt-2 p-2 text-center text-white bg-black hidden rounded-none">
          –†–∞—Å—á—ë—Ç –ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω
        </div>
      </div>
   </div>

   <div id="resultsContainer" class="w-full bg-[#E2E2E2] text-sm space-y-4 shadow-md px-4 pb-4 pt-4 rounded-none">
     <div>

       <div id="progressBarContainer" class="w-full h-5 relative overflow-hidden border rounded-none" style="border-color: #2511A8;">
         <div id="dailyProfitBar" class="absolute top-0 left-0 h-full transition-all duration-500" style="background-color: #2511A8;"></div>
         <div id="dailyElectricityCostBar" class="absolute top-0 h-full transition-all duration-500" style="background-color: #CCCCCC;"></div>
       </div>
       <div class="mt-1 text-xs text-black flex justify-between">
         <div id="profitPercentageLabel">–ü—Ä–∏–±—ã–ª—å: --%</div>
         <div id="costPercentageLabel">–ó–∞—Ç—Ä–∞—Ç—ã: --%</div>
       </div>
     </div>

     <div class="scroll-container w-full overflow-x-auto">
       <table id="resultsTable" class="result-table w-full text-sm text-center border-collapse">
         <thead>
           <tr>
             <th class="bg-black text-white p-0 w-24 align-middle">
               <div id="currencyButtonsContainer" class="flex justify-center items-center h-full">
                 <button id="currencyUSD" class="currency-btn w-7 h-7 active">$</button>
                 <button id="currencyRUB" class="currency-btn w-7 h-7 inactive">‚ÇΩ</button>
               </div>
             </th>
             <th class="bg-black text-white p-2">–î–µ–Ω—å</th>
             <th class="bg-black text-white p-2">–ú–µ—Å—è—Ü</th>
             <th class="bg-black text-white p-2">–ì–æ–¥</th>
           </tr>
         </thead>
         <tbody>
           <tr>
             <td class="bg-black text-white p-2 w-24">–î–æ—Ö–æ–¥</td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="income">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="income_rub">-- ‚ÇΩ</span>
             </td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="incomeMonth">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="incomeMonth_rub">-- ‚ÇΩ</span>
             </td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="incomeYear">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="incomeYear_rub">-- ‚ÇΩ</span>
             </td>
           </tr>
           <tr>
             <td class="bg-black text-white p-2 w-24">–ü—Ä–∏–±—ã–ª—å</td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="profit">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="profit_rub">-- ‚ÇΩ</span>
             </td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="profitMonth">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="profitMonth_rub">-- ‚ÇΩ</span>
             </td>
             <td class="bg-[#E2E2E2] text-black p-2">
               <span class="text-[#2511A8] font-semibold" id="profitYear">$ --.--</span>
               <span class="text-[#2511A8] font-semibold hidden" id="profitYear_rub">-- ‚ÇΩ</span>
             </td>
           </tr>
         </tbody>
       </table>
     </div>
     <div id="paybackRoiContainer" class="mt-4 text-black flex justify-between">
        <div>–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å –º–µ—Å.: <span id="payback">‚Äî</span></div>
        <div>–ì–æ–¥–æ–≤–æ–π %: <span id="roi">‚Äî</span></div>
      </div>
   </div>

   <div id="tutorialModalOverlay" class="tutorial-modal-overlay"></div>
   <div id="tutorialModal" class="tutorial-modal">
       <h3 id="tutorialTitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
       <p id="tutorialText">–≠—Ç–æ –∫—Ä–∞—Ç–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Å–≤–æ–∏—Ç—å—Å—è —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º.</p>
       <button id="tutorialNextBtn" class="tutorial-modal-next-btn">–î–∞–ª–µ–µ</button>
       <button id="tutorialSkipBtn" class="tutorial-modal-skip-btn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
   </div>

  <script>
// --- –ù–ê–ß–ê–õ–û –ë–õ–û–ö–ê –û–ë–£–ß–ï–ù–ò–Ø ---
const SUPABASE_URL = 'https://yiprwrgmyqlkdmhgulmc.supabase.co'; // –í–ê–® URL
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpcHJ3cmdteXFsa2RtaGd1bG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2NTI0NjgsImV4cCI6MjA2MDIyODQ2OH0.lfiTfr5ukGDEVuwq-X9U2kWs3nEZrp3N443HT5AkbfI'; // –í–ê–® ANON KEY

let supabaseClient;
try {
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
} catch (e) {
    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Supabase:", e);
}

let currentTutorialStep = 0;
let tutorialSteps = [];
let telegramUser = null;

const tutorialModalOverlay = document.getElementById('tutorialModalOverlay');
const tutorialModal = document.getElementById('tutorialModal');
const tutorialTitle = document.getElementById('tutorialTitle');
const tutorialText = document.getElementById('tutorialText');
const tutorialNextBtn = document.getElementById('tutorialNextBtn');
const tutorialSkipBtn = document.getElementById('tutorialSkipBtn');
let highlightedElement = null; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

async function initAppAndTutorial() {
    console.log("DOM fully loaded and parsed");
    Telegram.WebApp.ready();
    console.log("Telegram WebApp is ready.");

    // –°–Ω–∞—á–∞–ª–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    try {
        await fetchData();
        await onAlgorithmChange();
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:", error);
    }

    // –ó–∞—Ç–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è
    if (Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
        telegramUser = Telegram.WebApp.initDataUnsafe.user;
        if (telegramUser.id) {
            console.log("Telegram User ID:", telegramUser.id);
            await checkTutorialStatus();
        } else {
            console.warn("Telegram User ID –Ω–µ –Ω–∞–π–¥–µ–Ω. –û–±—É—á–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–æ.");
        }
    } else {
        console.warn("Telegram WebApp –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û–±—É—á–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–æ.");
    }
}

async function checkTutorialStatus() {
    if (!supabaseClient) {
        console.error("Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –û–±—É—á–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–æ.");
        return;
    }
    console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", telegramUser.id);
    try {
        let { data: user, error } = await supabaseClient
            .from('users')
            .select('telegram_id, tutor')
            .eq('telegram_id', telegramUser.id.toString())
            .single();

        if (error && error.code !== 'PGRST116') { // PGRST116 - "single row not found"
            console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase:", error);
            return;
        }

        if (user && user.tutor === true) {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–æ—à–µ–ª –æ–±—É—á–µ–Ω–∏–µ.");
        } else {
            if (!user) {
                console.log("–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª –æ–±—É—á–µ–Ω–∏–µ, –∑–∞–ø—É—Å–∫–∞–µ–º.");
            } else {
                console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à–µ–ª –æ–±—É—á–µ–Ω–∏–µ (tutor=false), –∑–∞–ø—É—Å–∫–∞–µ–º.");
            }
            setupTutorialStepsDefinition();
            startTutorialFlow();
        }
    } catch (e) {
        console.error("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è:", e);
    }
}

function setupTutorialStepsDefinition() {
    tutorialSteps = [
        {
            title: "–®–∞–≥ 1: –ê–ª–≥–æ—Ä–∏—Ç–º",
            text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ <b>–ê–ª–≥–æ—Ä–∏—Ç–º–∞</b> –º–∞–π–Ω–∏–Ω–≥–∞. –î–æ—Å—Ç—É–ø–Ω—ã SHA-256 (–¥–ª—è Bitcoin) –∏ Scrypt (–¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–Ω–µ—Ç).",
            elementId: "algorithmSelect",
        },
        {
            title: "–®–∞–≥ 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å",
            text: "–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ <b>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</b> –≤–∞—à–µ–≥–æ ASIC-–º–∞–π–Ω–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.",
            elementId: "manufacturerSelect",
        },
        {
            title: "–®–∞–≥ 3: –ú–æ–¥–µ–ª—å",
            text: "–ó–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é <b>–ú–æ–¥–µ–ª—å –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</b>. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–•—ç—à—Ä–µ–π—Ç –∏ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ) –ø–æ–¥—Å—Ç–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
            elementId: "asicModel",
        },
        {
            title: "–®–∞–≥ 4: –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",
            text: "–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ <b>–•—ç—à—Ä–µ–π—Ç</b> –∏ <b>–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</b> –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏.",
            elementId: "hashrateContainer", // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ö—ç—à—Ä–µ–π—Ç–æ–º
            alsoHighlight: "powerContainer" // –ò –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º
        },
        {
            title: "–®–∞–≥ 5: –°—Ç–æ–∏–º–æ—Å—Ç—å",
            text: "–£–∫–∞–∂–∏—Ç–µ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏</b> –∑–∞ 1 –∫–í—Ç‚ãÖ—á –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ/–≤–≤–µ–¥–∏—Ç–µ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</b> –≤ —Ä—É–±–ª—è—Ö.",
            elementId: "electricityCost",
            alsoHighlight: "asicCost"
        },
        {
            title: "–®–∞–≥ 6: –†–∞—Å—á–µ—Ç",
            text: "–ö–æ–≥–¥–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–≤–µ–¥–µ–Ω—ã, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</b>, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.",
            elementId: "calculateBtn",
        },
        {
            title: "–®–∞–≥ 7: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
            text: "–ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ <b>—à–∫–∞–ª—É –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</b>, –∞ –Ω–∏–∂–µ —Ç–∞–±–ª–∏—Ü—É —Å <b>–î–æ—Ö–æ–¥–æ–º</b> –∏ <b>–ü—Ä–∏–±—ã–ª—å—é</b>. –í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –≤–∞–ª—é—Ç—É ($/‚ÇΩ).",
            elementId: "progressBarContainer", // –®–∫–∞–ª–∞
            alsoHighlight: "resultsTable" // –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–¥–æ–±–∞–≤—å—Ç–µ ID, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
        },
        {
            title: "–®–∞–≥ 8: –û–∫—É–ø–∞–µ–º–æ—Å—Ç—å",
            text: "–í —Å–∞–º–æ–º –Ω–∏–∑—É –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ <b>–û–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</b> –∏ <b>–ì–æ–¥–æ–≤–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç</b> –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ (ROI).",
            elementId: "paybackRoiContainer", // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å—é –∏ ROI
        },
        {
            title: "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!",
            text: "–í—ã —É—Å–ø–µ—à–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –æ—Å–Ω–æ–≤–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞. –£–¥–∞—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤!",
            elementId: null, // –ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ
        }
    ];
}

function startTutorialFlow() {
    currentTutorialStep = 0;
    tutorialModalOverlay.style.display = 'block';
    tutorialModal.style.display = 'block';
    Telegram.WebApp.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º WebApp –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    displayCurrentTutorialStep();
}

function removeHighlight() {
    if (highlightedElement) {
        highlightedElement.classList.remove('tutorial-highlight');
        highlightedElement = null;
    }
    document.querySelectorAll('.tutorial-highlight').forEach(el => el.classList.remove('tutorial-highlight'));
}

function displayCurrentTutorialStep() {
    removeHighlight();

    if (currentTutorialStep >= tutorialSteps.length) {
        completeTutorialProcess();
        return;
    }

    const step = tutorialSteps[currentTutorialStep];
    tutorialTitle.textContent = step.title;
    tutorialText.innerHTML = step.text; // –ò—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è —Ç–µ–≥–∞ <b>

    if (step.elementId) {
        const targetElement = document.getElementById(step.elementId);
        if (targetElement) {
            highlightedElement = targetElement;
            highlightedElement.classList.add('tutorial-highlight');
            // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç—É
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        } else {
            console.warn(`–≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Å ID "${step.elementId}" –Ω–µ –Ω–∞–π–¥–µ–Ω.`);
        }
        if (step.alsoHighlight) {
            const alsoElement = document.getElementById(step.alsoHighlight);
            if (alsoElement) {
                alsoElement.classList.add('tutorial-highlight');
            }
        }
    }

    if (currentTutorialStep === tutorialSteps.length - 1) {
        tutorialNextBtn.textContent = "–ó–∞–≤–µ—Ä—à–∏—Ç—å";
    } else {
        tutorialNextBtn.textContent = "–î–∞–ª–µ–µ";
    }
}

tutorialNextBtn.addEventListener('click', () => {
    currentTutorialStep++;
    displayCurrentTutorialStep();
});

tutorialSkipBtn.addEventListener('click', () => {
    completeTutorialProcess(true); // true –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–ø—É—Å—Ç–∏–ª
});

async function completeTutorialProcess(skipped = false) {
    tutorialModalOverlay.style.display = 'none';
    tutorialModal.style.display = 'none';
    removeHighlight();
    console.log(skipped ? "–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ." : "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.");

    if (!telegramUser || !telegramUser.id || !supabaseClient) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è: –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ Supabase –∫–ª–∏–µ–Ω—Ç–∞.");
        return;
    }

    try {
        const { data, error } = await supabaseClient
            .from('users')
            .upsert(
                {
                    telegram_id: telegramUser.id.toString(),
                    tutor: true,
                    // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ created_at —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –ë–î
                    // updated_at –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä–æ–º –≤ –ë–î –∏–ª–∏ –∑–¥–µ—Å—å:
                    updated_at: new Date().toISOString()
                },
                {
                    onConflict: 'telegram_id', // –ü–æ–ª–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç
                    // ignoreDuplicates: false // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false, —Ç.–µ. –±—É–¥–µ—Ç UPDATE
                }
            )
            .select(); // –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é/–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å

        if (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è –≤ Supabase:", error);
            // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        } else {
            console.log("–°—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Supabase:", data);
        }
    } catch (e) {
        console.error("–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è:", e);
    }
}

// --- –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –û–ë–£–ß–ï–ù–ò–Ø ---


// –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–∞–ª–µ–µ:
let jsonData = [];
let currentAlgorithm = "SHA-256";
let dailyIncome = 0;
let dailyProfitValue = 0; // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ calculateProfit, –Ω–æ –Ω–µ dailyProfitValue –∏–∑ –æ–±—É—á–µ–Ω–∏—è
let dailyElectricityCostValue = 0; // Store electricity cost in USD
let monthlyProfit = 0;
let yearlyProfit = 0;
let usdtPrice = 0; // –•—Ä–∞–Ω–∏–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å USDT
let isUSD = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ª–ª–∞—Ä—ã

document.addEventListener("DOMContentLoaded", initAppAndTutorial); // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—â—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é

async function fetchData() {
    console.log("–ó–∞–≥—Ä—É–∑–∫–∞ kursBTC.txt...");
    try {
        const response = await fetch("https://hamsauno.github.io/Miner/kursBTC.txt");
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const text = await response.text();
        const data = text.trim().split("\n");
        console.log("‚úÖ –°—Ç—Ä–æ–∫–∏ –∏–∑ kursBTC.txt:", data);

        if (data.length >= 9) {
            const values = {
                btcPrice: parseFloat(data[0]),
                usdtPrice: parseFloat(data[1]), // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π usdtPrice
                profitPerTH: parseFloat(data[2]),
                ltcPrice: parseFloat(data[3]),
                dogePrice: parseFloat(data[4]),
                bellPrice: parseFloat(data[5]),
                profitPerLTC: parseFloat(data[6]),
                profitPerDOGE: parseFloat(data[7]),
                profitPerBELL: parseFloat(data[8]),
            };

            let dataValid = true;
            Object.entries(values).forEach(([key, val]) => {
                if (isNaN(val)) {
                    console.warn(`‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${key} –∏–∑ TXT:`, data[Object.keys(values).indexOf(key)]);
                    dataValid = false;
                }
                const el = document.getElementById(key);
                if (el && !isNaN(val)) {
                    el.value = val.toFixed(key.startsWith("profit") ? 8 : 2); // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö –ø–æ–ª–µ–π
                    if (key === "usdtPrice") {
                        usdtPrice = val; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                        console.log(`–ö—É—Ä—Å USDT –æ–±–Ω–æ–≤–ª–µ–Ω: ${usdtPrice}`);
                    }
                } else if (!el) {
                     console.warn(`‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç —Å ID ${key} –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ TXT.`);
                }
            });

            if (!dataValid) {
                // alert("–í–Ω–∏–º–∞–Ω–∏–µ: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ kursBTC.txt –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –†–∞—Å—á–µ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã.");
                console.warn("–í–Ω–∏–º–∞–Ω–∏–µ: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ kursBTC.txt –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.");
            } else {
                console.log("üì• –ó–Ω–∞—á–µ–Ω–∏—è –∏–∑ TXT —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.");
            }
        } else {
            console.warn("‚ùó –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–∫ –≤ kursBTC.txt. –û–∂–∏–¥–∞–ª–æ—Å—å 9 –∏–ª–∏ –±–æ–ª—å—à–µ.");
            // alert("–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ kursBTC.txt.");
        }
    } catch (e) {
        console.error("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ kursBTC.txt:", e);
        // alert(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–∞ (${e.message}). –†–∞—Å—á–µ—Ç—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã.`);
        const calcBtn = document.getElementById('calculateBtn');
        if(calcBtn) calcBtn.disabled = true;
    }
}


async function fetchJsonData() {
    console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ calc.json –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞: ${currentAlgorithm}...`);
    try {
        const response = await fetch("https://hamsauno.github.io/Miner/json/calc.json");
         if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        jsonData = data["–†–∞—Å—á—ë—Ç—ã"] ? data["–†–∞—Å—á—ë—Ç—ã"].filter(item => item["–ê–ª–≥–æ—Ä–∏—Ç–º"] === currentAlgorithm) : [];
        console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${jsonData.length} –º–æ–¥–µ–ª–µ–π –¥–ª—è ${currentAlgorithm}`);
        if (jsonData.length === 0) {
             console.warn(`‚ö†Ô∏è –ú–æ–¥–µ–ª–∏ –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ ${currentAlgorithm} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ calc.json`);
        }
    } catch (e) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ calc.json:`, e);
        jsonData = [];
        // alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (${e.message}). –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.`);
        const manufacturerSelect = document.getElementById("manufacturerSelect");
        const modelSelect = document.getElementById("asicModel");
        if (manufacturerSelect) manufacturerSelect.innerHTML = '<option>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
        if (modelSelect) modelSelect.innerHTML = '<option>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
    }
}

async function onAlgorithmChange() {
    const algorithmSelect = document.getElementById("algorithmSelect");
    if (!algorithmSelect) return;
    currentAlgorithm = algorithmSelect.value;
    console.log(`–ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${currentAlgorithm}`);

    await fetchJsonData();

    const manufacturerSelect = document.getElementById("manufacturerSelect");
    if (!manufacturerSelect) return;

    const uniqueManufacturers = [...new Set(jsonData.map(item => item["–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å"]?.toLowerCase() || 'unknown'))]
                                .filter(m => m !== 'unknown')
                                .sort();

    manufacturerSelect.innerHTML = "";

    if (uniqueManufacturers.length > 0) {
        uniqueManufacturers.forEach(m => {
            const opt = document.createElement("option");
            opt.value = m;
            opt.textContent = m.charAt(0).toUpperCase() + m.slice(1);
            manufacturerSelect.appendChild(opt);
        });
        manufacturerSelect.disabled = false;
         console.log(`–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ –¥–ª—è ${currentAlgorithm} –æ–±–Ω–æ–≤–ª–µ–Ω—ã.`);
        updateModelList();
    } else {
        manufacturerSelect.innerHTML = '<option>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</option>';
        manufacturerSelect.disabled = true;
        const modelSelect = document.getElementById("asicModel");
         if (modelSelect) {
             modelSelect.innerHTML = '<option>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</option>';
             modelSelect.disabled = true;
         }
         updateAsicSpecs();
         console.warn(`–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ –¥–ª—è ${currentAlgorithm} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`);
    }
}


function updateModelList() {
    const manufacturerSelect = document.getElementById("manufacturerSelect");
    const modelSelect = document.getElementById("asicModel");
    if (!manufacturerSelect || !modelSelect) return;

    const selectedManufacturer = manufacturerSelect.value?.toLowerCase();
    console.log(`–í—ã–±—Ä–∞–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ${selectedManufacturer}`);
    modelSelect.innerHTML = "";

    const models = jsonData.filter(item => item["–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å"]?.toLowerCase() === selectedManufacturer);

    if (models.length > 0) {
        models.forEach(item => {
            const opt = document.createElement("option");
            opt.value = `${item["–ú–æ–¥–µ–ª—å"]}|${item["–•–µ—à—Ä–µ–π—Ç"]}`;
            opt.textContent = `${item["–ú–æ–¥–µ–ª—å"]} (${item["–•–µ—à—Ä–µ–π—Ç"]} ${item["–ï–¥. –∏–∑–º."]})`;
            modelSelect.appendChild(opt);
        });
        modelSelect.disabled = false;
        console.log(`–ú–æ–¥–µ–ª–∏ –¥–ª—è ${selectedManufacturer} –æ–±–Ω–æ–≤–ª–µ–Ω—ã.`);
        updateAsicSpecs();
    } else {
        modelSelect.innerHTML = '<option>–ù–µ—Ç –º–æ–¥–µ–ª–µ–π</option>';
        modelSelect.disabled = true;
        updateAsicSpecs();
        console.warn(`–ú–æ–¥–µ–ª–∏ –¥–ª—è ${selectedManufacturer} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`);
    }
}


function updateAsicSpecs() {
    const modelSelect = document.getElementById("asicModel");
    const asicCostInput = document.getElementById("asicCost");
    const hashrateEl = document.getElementById("hashrate");
    const edpriceEl = document.getElementById("edprice");
    const powerEl = document.getElementById("power");
    const powerUnitEl = document.getElementById("power_unit");

    if (!modelSelect || !asicCostInput || !hashrateEl || !edpriceEl || !powerEl || !powerUnitEl) {
        console.error("–û–¥–∏–Ω –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ASIC –Ω–µ –Ω–∞–π–¥–µ–Ω.");
        return;
    }

    hashrateEl.textContent = '';
    edpriceEl.textContent = '';
    powerEl.textContent = '';
    powerUnitEl.textContent = '';
    asicCostInput.value = '';

    const selectedValue = modelSelect.value;
    if (!selectedValue || modelSelect.selectedOptions.length === 0 || modelSelect.selectedOptions[0].disabled || modelSelect.selectedOptions[0].textContent === "–ù–µ—Ç –º–æ–¥–µ–ª–µ–π" || modelSelect.selectedOptions[0].textContent === "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" || modelSelect.selectedOptions[0].textContent === "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏" ) {
        console.log("–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫.");
        asicCostInput.placeholder = selectedValue ? '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : '–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å';
        return;
    }


    const modelData = selectedValue.split("|");
    if (modelData.length < 2) {
        console.warn("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ modelSelect:", selectedValue);
        return;
    }
    const modelName = modelData[0];
    const modelHashrate = modelData[1];

    const item = jsonData.find(i => i["–ú–æ–¥–µ–ª—å"] === modelName && i["–•–µ—à—Ä–µ–π—Ç"] === modelHashrate);

    if (item) {
        console.log("–ù–∞–π–¥–µ–Ω–∞ –º–æ–¥–µ–ª—å:", item);
        hashrateEl.textContent = item["–•–µ—à—Ä–µ–π—Ç"] || '';
        edpriceEl.textContent = item["–ï–¥. –∏–∑–º."] || '';

        const powerValue = parseFloat(item["–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ"]);
        if (!isNaN(powerValue)) {
            powerEl.textContent = Math.round(powerValue);
            powerUnitEl.textContent = ' –í—Ç';
        } else {
             console.warn("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è:", item["–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ"]);
        }

        const itemPriceUSD = parseFloat(item["–¶–µ–Ω–∞"]);
        if (!isNaN(itemPriceUSD) && usdtPrice > 0) {
            const calculatedCostRUB = itemPriceUSD * usdtPrice;
            asicCostInput.value = Math.ceil(calculatedCostRUB / 100) * 100;
            console.log(`–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Å–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞: ${asicCostInput.value} ‚ÇΩ (–¶–µ–Ω–∞: $${itemPriceUSD}, –ö—É—Ä—Å: ${usdtPrice} ‚ÇΩ/$)`);
        } else {
            asicCostInput.placeholder = '–¶–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
            console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å ASIC. –¶–µ–Ω–∞: ${item["–¶–µ–Ω–∞"]}, –ö—É—Ä—Å USDT: ${usdtPrice}`);
        }
    } else {
        console.warn(`–î–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–µ–ª–∏ ${modelName} (${modelHashrate}) –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ jsonData.`);
        asicCostInput.placeholder = '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
    }
}

function showNotification() {
    const notification = document.getElementById('notification');
    if (notification) {
        notification.classList.remove('hidden');
        setTimeout(() => {
            notification.classList.add('hidden');
        }, 1000);
    }
}


function calculateProfit() {
    console.log("–ù–∞—á–∞–ª–æ —Ä–∞—Å—á–µ—Ç–∞...");
    const elements = {
        usdtPriceInput: document.getElementById("usdtPrice"),
        hashrateEl: document.getElementById("hashrate"),
        powerEl: document.getElementById("power"),
        electricityCostInput: document.getElementById('electricityCost'),
        asicCostInput: document.getElementById("asicCost"),
        btcPriceInput: document.getElementById("btcPrice"),
        profitPerTHInput: document.getElementById("profitPerTH"),
        ltcPriceInput: document.getElementById("ltcPrice"),
        dogePriceInput: document.getElementById("dogePrice"),
        bellPriceInput: document.getElementById("bellPrice"),
        profitPerLTCInput: document.getElementById("profitPerLTC"),
        profitPerDOGEInput: document.getElementById("profitPerDOGE"),
        profitPerBELLInput: document.getElementById("profitPerBELL"),
        incomeEl: document.getElementById("income"),
        incomeRubEl: document.getElementById("income_rub"),
        profitEl: document.getElementById("profit"),
        profitRubEl: document.getElementById("profit_rub"),
        incomeMonthEl: document.getElementById("incomeMonth"),
        incomeMonthRubEl: document.getElementById("incomeMonth_rub"),
        incomeYearEl: document.getElementById("incomeYear"),
        incomeYearRubEl: document.getElementById("incomeYear_rub"),
        profitMonthEl: document.getElementById("profitMonth"),
        profitMonthRubEl: document.getElementById("profitMonth_rub"),
        profitYearEl: document.getElementById("profitYear"),
        profitYearRubEl: document.getElementById("profitYear_rub"),
        roiEl: document.getElementById("roi"),
        paybackEl: document.getElementById("payback"),
        profitBar: document.getElementById("dailyProfitBar"),
        electricityBar: document.getElementById("dailyElectricityCostBar"),
        profitPercentageLabel: document.getElementById("profitPercentageLabel"),
        costPercentageLabel: document.getElementById("costPercentageLabel")
    };

    for (const key in elements) {
        if (!elements[key]) {
            console.error(`‚ùå –û—à–∏–±–∫–∞: –≠–ª–µ–º–µ–Ω—Ç ${key} –Ω–µ –Ω–∞–π–¥–µ–Ω! –†–∞—Å—á–µ—Ç –ø—Ä–µ—Ä–≤–∞–Ω.`);
            // alert(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç ${key} –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.`);
            return;
        }
    }
     console.log("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–π–¥–µ–Ω—ã.");

    const values = {
        currentUsdtPrice: parseFloat(elements.usdtPriceInput.value),
        hashrate: parseFloat(elements.hashrateEl.textContent),
        power: parseFloat(elements.powerEl.textContent),
        electricityCost: parseFloat(elements.electricityCostInput.value.replace(',', '.')),
        asicCost: parseFloat(elements.asicCostInput.value)
    };

     const baseValuesValid = !isNaN(values.currentUsdtPrice) && values.currentUsdtPrice > 0 &&
                            !isNaN(values.hashrate) && values.hashrate > 0 &&
                            !isNaN(values.power) && values.power >= 0 &&
                            !isNaN(values.electricityCost) && values.electricityCost >= 0 &&
                            !isNaN(values.asicCost) && values.asicCost >= 0;

    if (!baseValuesValid) {
         console.error("‚ùå –û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞.", values);
        //  alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ö—ç—à—Ä–µ–π—Ç, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–æ–∑–µ—Ç–∫–∏, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞—Å–∏–∫–∞). –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏.");
         return;
    }
     console.log("–ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:", values);

    dailyIncome = 0; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
    if (currentAlgorithm === "SHA-256") {
        const btcPrice = parseFloat(elements.btcPriceInput.value);
        const profitPerTH = parseFloat(elements.profitPerTHInput.value);
        if (!isNaN(btcPrice) && !isNaN(profitPerTH)) {
            dailyIncome = values.hashrate * profitPerTH * btcPrice;
        } else {
             console.error("‚ùå –û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ BTC –∏–ª–∏ ProfitPerTH.");
            //  alert("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ SHA-256.");
             return;
        }
    } else if (currentAlgorithm === "Scrypt") {
        const ltcPrice = parseFloat(elements.ltcPriceInput.value);
        const dogePrice = parseFloat(elements.dogePriceInput.value);
        const bellPrice = parseFloat(elements.bellPriceInput.value);
        const profitPerLTC = parseFloat(elements.profitPerLTCInput.value);
        const profitPerDOGE = parseFloat(elements.profitPerDOGEInput.value);
        const profitPerBELL = parseFloat(elements.profitPerBELLInput.value);
         if (!isNaN(ltcPrice) && !isNaN(dogePrice) && !isNaN(bellPrice) &&
            !isNaN(profitPerLTC) && !isNaN(profitPerDOGE) && !isNaN(profitPerBELL))
         {
            const incomeLTC = values.hashrate * profitPerLTC * ltcPrice;
            const incomeDOGE = values.hashrate * profitPerDOGE * dogePrice;
            const incomeBELL = values.hashrate * profitPerBELL * bellPrice;
            dailyIncome = incomeLTC + incomeDOGE + incomeBELL;
         } else {
              console.error("‚ùå –û—à–∏–±–∫–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ Scrypt.");
            //   alert("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ Scrypt.");
              return;
         }
    }
     console.log(`–î–Ω–µ–≤–Ω–æ–π –¥–æ—Ö–æ–¥ ($): ${dailyIncome}`);

    const dailyElectricityCostRub = (values.power / 1000) * values.electricityCost * 24;
    dailyElectricityCostValue = values.currentUsdtPrice > 0 ? dailyElectricityCostRub / values.currentUsdtPrice : 0; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è
    console.log(`–î–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ ($): ${dailyElectricityCostValue}`);

    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é dailyProfitValue (–∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –≤ updateProgressBarAndLabels)
    // –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç dailyProfitValue, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –≤ –∫–æ–¥–µ –æ–±—É—á–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.
    // –Ø –æ—Å—Ç–∞–≤–ª—é –∫–∞–∫ –µ—Å—Ç—å, —Ç.–∫. –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ updateProgressBarAndLabels
    window.dailyProfitValue = dailyIncome - dailyElectricityCostValue; // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.dailyProfitValue —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å

    monthlyProfit = window.dailyProfitValue * 30.5; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è
    yearlyProfit = window.dailyProfitValue * 365;   // –ì–ª–æ–±–∞–ª—å–Ω–∞—è
    console.log(`–î–Ω–µ–≤–Ω–∞—è –ø—Ä–∏–±—ã–ª—å ($): ${window.dailyProfitValue}`);

    const asicCostInUSD = values.currentUsdtPrice > 0 ? values.asicCost / values.currentUsdtPrice : Infinity;
    const roi = (yearlyProfit && asicCostInUSD > 0 && isFinite(asicCostInUSD)) ? (yearlyProfit / asicCostInUSD) * 100 : 0;
    const payback = (window.dailyProfitValue > 0 && asicCostInUSD > 0 && isFinite(asicCostInUSD)) ? (asicCostInUSD / window.dailyProfitValue) / 30.5 : Infinity;
    console.log(`–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Å–∏–∫–∞ ($): ${asicCostInUSD}, –ì–æ–¥–æ–≤–æ–π ROI: ${roi}%, –û–∫—É–ø–∞–µ–º–æ—Å—Ç—å (–º–µ—Å): ${payback}`);

    updateTableValues();
    updateProgressBarAndLabels(elements);

    elements.roiEl.innerText = isFinite(roi) ? roi.toFixed(1) : "‚Äî";
    elements.paybackEl.innerText = isFinite(payback) ? payback.toFixed(1) : "‚Äî";

    showNotification();

    console.log("–†–∞—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω.");
}

function formatCurrency(value, currency = "$", fractionDigits = 2) {
    if (isNaN(value) || !isFinite(value)) return currency === "$" ? "$ --.--" : "--.-- ‚ÇΩ";
    const multiplier = Math.pow(10, fractionDigits);
    const roundedValue = Math.round(value * multiplier) / multiplier;
    return currency + roundedValue.toLocaleString('ru-RU', { minimumFractionDigits: fractionDigits, maximumFractionDigits: fractionDigits });
};
 function formatCurrencyRub(value, fractionDigits = 0) {
    if (isNaN(value) || !isFinite(value) || isNaN(usdtPrice) || usdtPrice <= 0) return "-- ‚ÇΩ";
    const rubValue = value * usdtPrice;
     const multiplier = Math.pow(10, fractionDigits);
    const roundedValue = Math.round(rubValue * multiplier) / multiplier;
    return roundedValue.toLocaleString('ru-RU', { maximumFractionDigits: fractionDigits }) + " ‚ÇΩ";
};


function updateTableValues() {
    const elementsToToggle = [
        "income", "incomeMonth", "incomeYear",
        "profit", "profitMonth", "profitYear"
    ];

    elementsToToggle.forEach(id => {
        const usdEl = document.getElementById(id);
        const rubEl = document.getElementById(`${id}_rub`);
        if (usdEl && rubEl) {
            let valueUSD = 0;
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤ calculateProfit
            if (id.startsWith("incomeMonth")) valueUSD = dailyIncome * 30.5;
            else if (id.startsWith("incomeYear")) valueUSD = dailyIncome * 365;
            else if (id.startsWith("income")) valueUSD = dailyIncome;
            else if (id.startsWith("profitMonth")) valueUSD = monthlyProfit; // global monthlyProfit
            else if (id.startsWith("profitYear")) valueUSD = yearlyProfit;  // global yearlyProfit
            else if (id.startsWith("profit")) valueUSD = window.dailyProfitValue; // global dailyProfitValue

            usdEl.innerText = formatCurrency(valueUSD);
            rubEl.innerText = formatCurrencyRub(valueUSD);

            if (isUSD) {
                usdEl.classList.remove("hidden");
                rubEl.classList.add("hidden");
            } else {
                usdEl.classList.add("hidden");
                rubEl.classList.remove("hidden");
            }
        } else {
            console.warn(`–≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã ${id} / ${id}_rub –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`);
        }
    });
}

function setCurrency(setToUSD) {
    if (isUSD === setToUSD) return;

    isUSD = setToUSD;
    const usdBtn = document.getElementById('currencyUSD');
    const rubBtn = document.getElementById('currencyRUB');

    if (usdBtn && rubBtn) {
        if (isUSD) {
            usdBtn.classList.remove('inactive');
            usdBtn.classList.add('active');
            rubBtn.classList.remove('active');
            rubBtn.classList.add('inactive');
        } else {
            usdBtn.classList.remove('active');
            usdBtn.classList.add('inactive');
            rubBtn.classList.remove('inactive');
            rubBtn.classList.add('active');
        }
        updateTableValues();
        console.log(`–í–∞–ª—é—Ç–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞: ${isUSD ? 'USD' : 'RUB'}`);
    } else {
        console.warn("–ö–Ω–æ–ø–∫–∏ –≤–∞–ª—é—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
    }
}

function updateProgressBarAndLabels(elements) {
    const profitBar = elements.profitBar;
    const electricityBar = elements.electricityBar;
    const profitLabel = elements.profitPercentageLabel;
    const costLabel = elements.costPercentageLabel;

    let profitPercentage = 0;
    let electricityPercentage = 0;

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ dailyIncome –∏ dailyElectricityCostValue
    if (dailyIncome > 0 && isFinite(dailyIncome) && isFinite(dailyElectricityCostValue)) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é window.dailyProfitValue (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤ calculateProfit)
        profitPercentage = Math.max(0, (window.dailyProfitValue / dailyIncome) * 100);
        electricityPercentage = Math.max(0, (dailyElectricityCostValue / dailyIncome) * 100);

        if (window.dailyProfitValue <= 0) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–±—ã–ª—å
            profitPercentage = 0;
            electricityPercentage = 100; // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∏–±—ã–ª–∏, –≤—Å–µ –∑–∞—Ç—Ä–∞—Ç—ã
        } else if (profitPercentage + electricityPercentage > 100.1) { // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è, –µ—Å–ª–∏ —Å—É–º–º–∞ > 100%
             electricityPercentage = 100 - profitPercentage;
        }

        profitPercentage = Math.min(100, Math.max(0, profitPercentage));
        electricityPercentage = Math.min(100, Math.max(0, electricityPercentage));

        profitBar.style.width = `${profitPercentage.toFixed(1)}%`;
        electricityBar.style.width = `${electricityPercentage.toFixed(1)}%`;
        electricityBar.style.left = `${profitPercentage.toFixed(1)}%`;
        // –¶–≤–µ—Ç–∞ —É–∂–µ –∑–∞–¥–∞–Ω—ã –≤ HTML, –Ω–æ –º–æ–∂–Ω–æ –∏ –∑–¥–µ—Å—å –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
        // profitBar.style.backgroundColor = "#2511A8";
        // electricityBar.style.backgroundColor = "#CCCCCC"; // –í–∞—à –∏—Å—Ö–æ–¥–Ω—ã–π —Ü–≤–µ—Ç –±—ã–ª #FFFFFF, –Ω–æ –≤ —Ä–∞–∑–º–µ—Ç–∫–µ #CCCCCC

        profitLabel.textContent = `–ü—Ä–∏–±—ã–ª—å: ${profitPercentage.toFixed(1)}%`;
        costLabel.textContent = `–ó–∞—Ç—Ä–∞—Ç—ã: ${electricityPercentage.toFixed(1)}%`;

    } else {
        profitBar.style.width = "0%";
        electricityBar.style.width = "0%";
        electricityBar.style.left = "0%";
        profitLabel.textContent = `–ü—Ä–∏–±—ã–ª—å: --%`;
        costLabel.textContent = `–ó–∞—Ç—Ä–∞—Ç—ã: --%`;
    }
}

// –ü—Ä–∏–≤—è–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
const algorithmSelect = document.getElementById("algorithmSelect");
const manufacturerSelect = document.getElementById("manufacturerSelect");
const asicModelSelect = document.getElementById("asicModel"); // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
const calculateBtn = document.getElementById("calculateBtn"); // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª
const currencyUSD_Btn = document.getElementById('currencyUSD');
const currencyRUB_Btn = document.getElementById('currencyRUB');

if (algorithmSelect) algorithmSelect.addEventListener("change", onAlgorithmChange);
if (manufacturerSelect) manufacturerSelect.addEventListener("change", updateModelList);
if (asicModelSelect) asicModelSelect.addEventListener("change", updateAsicSpecs); // –ò—Å–ø–æ–ª—å–∑—É–µ–º asicModelSelect
if (calculateBtn) calculateBtn.addEventListener("click", calculateProfit);     // –ò—Å–ø–æ–ª—å–∑—É–µ–º calculateBtn
if (currencyUSD_Btn) currencyUSD_Btn.addEventListener('click', () => setCurrency(true));
if (currencyRUB_Btn) currencyRUB_Btn.addEventListener('click', () => setCurrency(false));

  </script>
</body>
</html>
