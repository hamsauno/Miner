<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
    }
    @keyframes bgTransition {
      0% { background-color: #000000; }
      100% { background-color: #2511A8; }
    }
    body {
      animation: bgTransition 2s forwards;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen overflow-hidden">

  <!-- –ë–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="startScreen" class="flex flex-col items-center justify-center w-full h-screen bg-black">
    <img id="logo" src="img/WAYMORR.png" class="w-full max-w-md opacity-0 transition-opacity duration-1000" alt="WAYMORR Logo" />
    <button id="startBtn" class="mt-6 text-white text-2xl font-bold opacity-0 animate-pulse">–ù–ê–ß–ê–¢–¨</button>
  </div>

<script>
const { createClient } = supabase;
const supabaseUrl = "https://yiprwrgmyqlkdmhgulmc.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpcHJ3cmdteXFsa2RtaGd1bG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2NTI0NjgsImV4cCI6MjA2MDIyODQ2OH0.lfiTfr5ukGDEVuwq-X9U2kWs3nEZrp3N443HT5AkbfI";
const supabaseClient = createClient(supabaseUrl, supabaseKey);

document.addEventListener("DOMContentLoaded", async () => {
  const tg = window.Telegram.WebApp;
  tg.ready();

  const logo = document.getElementById("logo");
  const startBtn = document.getElementById("startBtn");

  setTimeout(() => {
    logo.classList.add("opacity-100");
    startBtn.classList.add("opacity-100");
  }, 2000);

  startBtn.addEventListener("click", async () => {
    const telegramId = tg?.initDataUnsafe?.user?.id;
    const username = tg?.initDataUnsafe?.user?.username || "unknown";

    if (!telegramId || typeof telegramId !== "number") {
      alert("‚ùóÔ∏è Telegram ID –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram.");
      return;
    }

    try {
      const { data, error } = await supabaseClient
        .from("users")
        .select("*")
        .eq("telegram_id", telegramId.toString());

      if (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error.message);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
        return;
      }

      if (data && data.length === 0) {
        console.log("üÜï –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å.");
        await supabaseClient
          .from("users")
          .insert([{
            telegram_id: telegramId.toString(),
            username: username,
            bonus: 0
          }]);
      } else {
        console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
      }

      // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
      document.getElementById("startScreen").classList.add("opacity-0", "transition-opacity", "duration-1000");
      setTimeout(() => {
        window.location.href = "home.html";
      }, 1000);

    } catch (err) {
      console.error("‚ùóÔ∏è –û—à–∏–±–∫–∞:", err);
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å.");
    }
  });
});
</script>

</body>
</html>

