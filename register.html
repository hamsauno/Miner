<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
      <script src="js/fullscr.js" defer></script><!-- –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–æ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å -->
      <script src="js/nozoom.js" defer></script><!-- —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞—Ç—å –∑—É–º -->
  
</head>
<body class="bg-[#222222] pt-[52px] text-white font-[Arial] flex flex-col items-center justify-center min-h-screen">

  <!--  –ë–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loading" class="flex flex-col items-center justify-center text-center text-white mb-6">
    <svg class="animate-spin h-8 w-8 text-orange-400 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10"
              stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8v8H4z"></path>
    </svg>
    <span class="text-sm">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</span>
  </div>

  <!--  –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div class="w-full max-w-sm p-4 bg-[#333333] rounded-2xl shadow-md hidden" id="registerForm">
    <h2 class="text-xl font-bold mb-4 text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="username" type="text" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
      class="w-full mb-3 p-2 rounded bg-[#444] text-white placeholder-gray-400 outline-none" />
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"
      class="w-full mb-4 p-2 rounded bg-[#444] text-white placeholder-gray-400 outline-none" />

          <!--  –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö -->
          <div class="text-xs text-gray-400 mb-3 text-center">
            –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É ¬´–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è¬ª, –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ 
            <button onclick="document.getElementById('consentModal').showModal()" class="underline text-orange-400 hover:text-orange-300">
              —É—Å–ª–æ–≤–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            </button>.
          </div>
    
          <button id="registerBtn"
            class="w-full bg-green-600 hover:bg-green-700 transition-all py-2 rounded font-semibold text-black"
            style="background: linear-gradient(90deg, #F6A314, #EC7E07);">
            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
          </button>

          <div class="text-sm text-gray-500 pt-2">
            <p><b>Telegram ID:</b> <span id="telegram_id"></span></p>
          </div>
  </div>
                 <!-- üìÑ –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
                <dialog id="consentModal" class="w-[90%] max-w-xl p-6 rounded-2xl bg-[#2c2c2c] text-white shadow-xl">
                <h3 class="text-lg font-bold mb-4">üìÑ –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="text-sm max-h-[60vh] overflow-y-auto leading-relaxed text-gray-300">
                  <p>–ù–∞—Å—Ç–æ—è—â–∏–º —è, [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å], —Å–≤–æ–±–æ–¥–Ω–æ, —Å–≤–æ–µ–π –≤–æ–ª–µ–π –∏ –≤ —Å–≤–æ—ë–º –∏–Ω—Ç–µ—Ä–µ—Å–µ –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–¥–∞–ª–µ–µ ‚Äî –û–ø–µ—Ä–∞—Ç–æ—Ä), –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Telegram-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Legit Mining, –∞ –∏–º–µ–Ω–Ω–æ:</p>
                  <ul class="list-disc list-inside my-2">
                    <li>Telegram ID, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—è, –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞).</li>
                  </ul>
                  <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ü–µ–ª—è—Ö:</p>
                  <ul class="list-disc list-inside my-2">
                    <li>—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏;</li>
                    <li>–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –∏ —Å–µ—Ä–≤–∏—Å–∞–º Legit Mining;</li>
                    <li>—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;</li>
                    <li>–æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤ —Ç–æ–º —á–∏—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π).</li>
                  </ul>
                  <p>–û–ø–µ—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ä–µ–¥—Å—Ç–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏/–∏–ª–∏ –±–µ–∑ —Ç–∞–∫–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º.</p>
                  <p class="my-2">–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: –¥–æ –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–∑—ã–≤–∞ —Å–æ–≥–ª–∞—Å–∏—è –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.</p>
                  <p>–Ø —É–≤–µ–¥–æ–º–ª—ë–Ω(–∞), —á—Ç–æ:</p>
                  <ul class="list-disc list-inside my-2">
                    <li>–º–æ–≥—É –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ, –Ω–∞–ø–∏—Å–∞–≤ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ Telegram.</li>
                    <li>–º–æ–≥—É –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–µ.</li>
                  </ul>
                  <p>–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É ¬´–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è¬ª, —è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é —Å–≤–æ—ë —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
                </div>
                    <div class="mt-4 flex justify-end">
                      <button onclick="document.getElementById('consentModal').close()"
                        class="px-4 py-2 rounded text-black font-semibold transition-all"
                        style="background: linear-gradient(90deg, #F6A314, #EC7E07);">
                        –ó–∞–∫—Ä—ã—Ç—å
                      </button>
                    </div>
              </dialog>

<script>
  const { createClient } = supabase;
  const supabaseUrl = "https://yiprwrgmyqlkdmhgulmc.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpcHJ3cmdteXFsa2RtaGd1bG1jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2NTI0NjgsImV4cCI6MjA2MDIyODQ2OH0.lfiTfr5ukGDEVuwq-X9U2kWs3nEZrp3N443HT5AkbfI";
  const supabaseClient = createClient(supabaseUrl, supabaseKey);

  document.addEventListener("DOMContentLoaded", async () => {
    const tg = window.Telegram.WebApp;
    tg.ready();

    const loadingEl = document.getElementById("loading");
    const formEl = document.getElementById("registerForm");

    loadingEl.style.display = "flex";
    formEl.style.display = "none";

    const telegramId = tg?.initDataUnsafe?.user?.id;

    // üí° –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ ID –Ω–∞–π–¥–µ–Ω –∏ —ç—Ç–æ —á–∏—Å–ª–æ
    if (!telegramId || typeof telegramId !== "number") {
      alert("‚ùóÔ∏è Telegram ID –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram WebApp.");
      loadingEl.style.display = "none";
      return;
    }

    try {
      // üõ† –û—Ç–ª–∞–¥–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
      // const { data: allUsers, error: allUsersError } = await supabaseClient
      //   .from("users")
      //   .select("*");
      // console.log(" –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:", allUsers, allUsersError);

      //  –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —ç—Ç–∏–º telegram_id
      const { data, error } = await supabaseClient
        .from("users")
        .select("*")
        .eq("telegram_id", telegramId.toString());

      console.log(" –û—Ç–≤–µ—Ç –æ—Ç Supabase:", data, error);

      if (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error.message);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
        loadingEl.style.display = "none";
        return;
      }

      if (data && data.length > 0) {
        console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:", data[0]);
        localStorage.setItem("username", data[0].username);
        window.location.href = "myprofile.html";
      } else {
        console.log("üÜï –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É.");
        loadingEl.style.display = "none";
        formEl.style.display = "block";
      }

    } catch (err) {
      console.error("‚ùóÔ∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:", err);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Telegram ID.");
      loadingEl.style.display = "none";
    }
  });
</script>
  <script>
  document.getElementById("registerBtn").addEventListener("click", async () => {
    const tg = window.Telegram.WebApp;
    const telegramId = tg?.initDataUnsafe?.user?.id;

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
      alert("‚ùóÔ∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
      return;
    }

    try {
      const { data, error } = await supabaseClient
      .from("users")
      .insert([{
        telegram_id: telegramId.toString(),
        username: username,
        password: password,
        bonus: 0  // ‚Üê –∑–∞–ø–∏—Å—ã–≤–∞–µ–º 0 –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      }]);

      if (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error.message);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
        return;
      }

      console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:", data);
      localStorage.setItem("username", username);
      window.location.href = "myprofile.html";

    } catch (err) {
      console.error("‚ùóÔ∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", err);
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
    }
  });
</script>


</body>
</html>

