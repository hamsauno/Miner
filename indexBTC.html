<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <style>
        body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a1a, #0d0d0d);
            color: #ffffff;
            transition: background-color 0.3s, color 0.3s;
            text-align: left;
        }

        h2 {
            color: #ff9800;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            font-size: 16px;
        }

        input, select, button {
            display: block;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-bottom: 20px;
            background-color: #333;
            color: #fff;
            border: 2px solid #444;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.2s ease;
        }

        input:focus, select:focus, button:focus {
            border-color: #ff9800;
            outline: none;
        }

        button {
            cursor: pointer;
            background-color: #ff9800;
            color: white;
            font-size: 18px;
            font-weight: 700;
            border: none;
            transition: background-color 0.3s, transform 0.2s ease;
        }

        button:hover {
            background-color: #e68900;
            transform: translateY(-3px);
        }

        button:active {
            background-color: #c77b00;
            transform: translateY(1px);
        }

        p {
            font-size: 18px;
            margin: 10px 0;
        }

        .back-button {
            background-color: #444;
            color: #fff;
            padding: 12px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: background-color 0.3s, transform 0.2s ease;
        }

        .back-button:hover {
            background-color: #555;
            transform: translateY(-3px);
        }

        .back-button:active {
            background-color: #666;
            transform: translateY(1px);
        }

        .result-value {
            font-size: 20px;
            font-weight: 700;
            color: #ff9800;
        }
    </style>
</head>
<body>

    <script>
    // Функция для получения данных с удалённого текстового файла
    async function fetchData() {
        const url = "https://hamsauno.github.io/Miner/kursBTC.txt"; // Новый URL

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Не удалось загрузить данные.');
            }
            const data = await response.text();
            
            // Разбиваем данные на строки
            const lines = data.trim().split("\n");
            
            // Убедимся, что строк достаточно для всех данных
            if (lines.length >= 3) {
                const btcPrice = parseFloat(lines[0].trim());
                const usdtPrice = parseFloat(lines[1].trim());
                const profitPerTH = parseFloat(lines[2].trim());

                if (!isNaN(btcPrice) && !isNaN(usdtPrice) && !isNaN(profitPerTH)) {
                    document.getElementById("btcPrice").value = btcPrice.toFixed(2);
                    document.getElementById("usdtPrice").value = usdtPrice.toFixed(2);
                    document.getElementById("profitPerTH").value = profitPerTH.toFixed(8);
                } else {
                    console.error("Ошибка: Данные из файла не являются валидными числами.");
                    document.getElementById("btcPrice").value = "Ошибка";
                    document.getElementById("usdtPrice").value = "Ошибка";
                    document.getElementById("profitPerTH").value = "Ошибка";
                }
            } else {
                console.error("Ошибка: недостаточно строк в файле.");
            }
        } catch (error) {
            console.error("Ошибка загрузки файла:", error);
            document.getElementById("btcPrice").value = "Ошибка при загрузке данных.";
            document.getElementById("usdtPrice").value = "Ошибка при загрузке данных.";
            document.getElementById("profitPerTH").value = "Ошибка при загрузке данных.";
        }
    }

    // Функция для обновления характеристик выбранной модели ASIC
    function updateAsicSpecs() {
        const asicData = {
            S21XP: { a: 270, b: 3645 },
            S21pl235: { a: 235, b: 3878 },
            S21pl225: { a: 225, b: 3713 },
            S21pl216: { a: 216, b: 3564 },
            T21190: { a: 190, b: 3610 },
            S19k120: { a: 120, b: 2760 }
        };

        let selectedModel = document.getElementById("asicModel").value;
        document.getElementById("hashrate").value = asicData[selectedModel].a;
        document.getElementById("power").value = asicData[selectedModel].b;
    }

    // Функция для расчёта доходности и прибыли
    function calculateProfit() {
        const btcPrice = parseFloat(document.getElementById("btcPrice").value);
        const usdtPrice = parseFloat(document.getElementById("usdtPrice").value);
        const profitPerTH = parseFloat(document.getElementById("profitPerTH").value);

        if (isNaN(btcPrice) || isNaN(usdtPrice) || isNaN(profitPerTH)) {
            alert("Данные для расчета отсутствуют или некорректны.");
            return;
        }

        let a = parseFloat(document.getElementById("hashrate").value);
        let b = parseFloat(document.getElementById("power").value);
        let h = parseFloat(document.getElementById("electricityCost").value);
        let c = parseFloat(document.getElementById("asicCost").value);

        let dailyIncome = a * profitPerTH * btcPrice;
        let monthlyIncome = dailyIncome * 30.5;
        let yearlyIncome = dailyIncome * 365;

        let dailyElectricityCost = ((b / 1000) * h * 24) / usdtPrice;
        let dailyProfit = dailyIncome - dailyElectricityCost;
        let monthlyProfit = dailyProfit * 30.5;
        let yearlyProfit = dailyProfit * 365;
        let roi = (dailyProfit * 365 / (c / usdtPrice)) * 100;
        let payback = ((c / usdtPrice) / dailyProfit) / 30.5;

        document.getElementById("income").innerText = dailyIncome.toFixed(2);
        document.getElementById("profit").innerText = dailyProfit.toFixed(2);
        document.getElementById("incomeMonth").innerText = monthlyIncome.toFixed(2);
        document.getElementById("incomeYear").innerText = yearlyIncome.toFixed(2);
        document.getElementById("profitMonth").innerText = monthlyProfit.toFixed(2);
        document.getElementById("profitYear").innerText = yearlyProfit.toFixed(2);
        document.getElementById("roi").innerText = roi.toFixed(2);
        document.getElementById("payback").innerText = payback.toFixed(0);
    }

    // Загружаем данные и обновляем элементы
    window.onload = async function() {
        await fetchData(); // Загружаем данные из файла kursBTC.txt
        updateAsicSpecs(); // Обновляем характеристики ASIC
    }
    </script>

    <button class="back-button" onclick="window.history.back();">Назад</button>

   <label for="asicModel">Модель Асика:</label>
        <select id="asicModel" onchange="updateAsicSpecs()">
            <option value="S21XP">Antminer S21 XP 270Th</option>
            <option value="S21pl235">Antminer S21+ 235Th</option>
            <option value="S21pl225">Antminer S21+ 225Th</option>
            <option value="S21pl216">Antminer S21+ 216Th</option>
            <option value="T21190">Antminer T21 190Th</option>
            <option value="S19k120">Antminer S19k Pro 120Th</option>
        </select>
    </label>

    <label for="electricityCost">Стоимость розетки (руб):</label>
    <input type="number" id="electricityCost" value="5">

    <label for="asicCost">Стоимость Асика (руб):</label>
    <input type="number" id="asicCost" value="500000">

    <label for="hashrate">Хэшрейт (TH/s):</label>
    <input type="number" id="hashrate" readonly>

    <label for="power">Энергопотребление (Вт):</label>
    <input type="number" id="power" readonly>

    <label><input type="hidden" id="btcPrice"></label>
    <label><input type="hidden" id="usdtPrice"></label>
    <label><input type="hidden" id="profitPerTH"></label>

    <button onclick="calculateProfit()">Рассчитать</button>
    
    <h2>Результаты</h2>
    <p>Доход:</p>
    <p>День: <span id="income" class="result-value">0</span> $</p>
    <p>Месяц: <span id="incomeMonth" class="result-value">0</span> $</p>
    <p>Год: <span id="incomeYear" class="result-value">0</span> $</p>

    <p>Прибыль:</p>
    <p>День: <span id="profit" class="result-value">0</span> $</p>
    <p>Месяц: <span id="profitMonth" class="result-value">0</span> $</p>
    <p>Год: <span id="profitYear" class="result-value">0</span> $</p>

    <p>Процент годовых: <span id="roi" class="result-value">0</span>%</p>
    <p>Окупаемость: <span id="payback" class="result-value">0</span> месяцев</p>

</body>
</html>
